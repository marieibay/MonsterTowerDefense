<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<link rel="icon" type="image/svg+xml" href="/vite.svg" />
<!-- Enhanced mobile viewport -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0, minimum-scale=1.0, viewport-fit=cover, shrink-to-fit=no" />

<!-- PWA-style fullscreen on mobile -->
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Tower Defense">

<!-- Prevent address bar auto-hide issues -->
<meta name="theme-color" content="#000000">
<meta name="msapplication-navbutton-color" content="#000000">

<title>Kingdom Defense: Tower Rush</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

<script type="importmap">
{
  "imports": {
    "react/": "https://esm.sh/react@^19.1.1/",
    "react": "https://esm.sh/react@^19.1.1",
    "react-dom/": "https://esm.sh/react-dom@^19.1.1/",
    "@google/genai": "https://aistudiocdn.com/@google/genai@^1.19.0"
  }
}
</script>

<style>
  :root {
    /* CSS custom properties for dynamic height */
    --doc-height: 100vh;
  }
  
  html, body {
    margin: 0;
    padding: 0;
    width: 100%;
    height: var(--doc-height);
    overflow: hidden;
    font-family: 'Press Start 2P', cursive;
    background-color: black;
    position: fixed;
    overscroll-behavior: none;
    /* Prevent elastic scrolling */
    -webkit-overflow-scrolling: touch;
  }
  
  #root {
    width: 100%;
    height: var(--doc-height);
    position: relative;
  }
  
  body {
    image-rendering: pixelated;
    image-rendering: -moz-crisp-edges;
    image-rendering: crisp-edges;
    touch-action: none;
    -webkit-touch-callout: none;
    -webkit-user-select: none;
    -webkit-tap-highlight-color: transparent;
    -webkit-text-size-adjust: none;
    /* Prevent iOS Safari zoom */
    -webkit-user-scalable: no;
  }
  
  /* Force fullscreen on mobile browsers */
  @media screen and (max-width: 768px) {
    html, body, #root {
      width: 100vw;
      height: 100vh;
      height: var(--doc-height);
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
    }
    
    /* Hide mobile browser UI */
    body {
      padding-top: env(safe-area-inset-top);
      padding-bottom: env(safe-area-inset-bottom);
      padding-left: env(safe-area-inset-left);
      padding-right: env(safe-area-inset-right);
    }
  }
  
  /* Landscape hint - gentler approach */
  .landscape-hint {
    position: fixed;
    top: 10px;
    left: 50%;
    transform: translateX(-50%);
    background-color: rgba(0, 0, 0, 0.9);
    color: white;
    padding: 8px 16px;
    border-radius: 8px;
    font-size: 10px;
    z-index: 10000;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.5s ease;
    border: 1px solid rgba(255, 255, 255, 0.2);
  }
  
  /* Show hint only on portrait mobile */
  @media (max-width: 768px) and (orientation: portrait) {
    .landscape-hint {
      opacity: 1;
    }
  }
</style>
</head>
<body class="bg-black">
<div class="landscape-hint">
ðŸ”„ Rotate device for optimal experience
</div>
<div id="root"></div>
<audio id="bg-music" src="https://storage.googleapis.com/lev-public-files/medieval-lute.mp3" loop></audio>
<script type="module" src="/index.tsx"></script>

<script>
  // Dynamic viewport height calculation for mobile
  function setDocumentHeight() {
    document.documentElement.style.setProperty('--doc-height', `${window.innerHeight}px`);
  }
  
  // Set initial height
  setDocumentHeight();
  
  // Update on resize and orientation change
  window.addEventListener('resize', setDocumentHeight);
  window.addEventListener('orientationchange', () => {
    setTimeout(setDocumentHeight, 100); // Delay for iOS
  });
  
  // Prevent zoom on double tap
  let lastTouchEnd = 0;
  document.addEventListener('touchend', function (event) {
    const now = (new Date()).getTime();
    if (now - lastTouchEnd <= 300) {
      event.preventDefault();
    }
    lastTouchEnd = now;
  }, { passive: false });
  
  // Prevent context menu
  document.addEventListener('contextmenu', function(e) {
    e.preventDefault();
  });
  
  // Prevent scrolling
  document.addEventListener('touchmove', function(e) {
    e.preventDefault();
  }, { passive: false });
  
  // Prevent pull-to-refresh
  document.addEventListener('touchstart', function(e) {
    if (e.touches.length > 1) {
      e.preventDefault();
    }
  }, { passive: false });
  
  // Enhanced fullscreen for mobile
  function attemptFullscreen() {
    const elem = document.documentElement;
    
    if (elem.requestFullscreen) {
      return elem.requestFullscreen({ navigationUI: "hide" });
    } else if (elem.webkitRequestFullscreen) {
      return elem.webkitRequestFullscreen();
    } else if (elem.msRequestFullscreen) {
      return elem.msRequestFullscreen();
    }
    
    return Promise.resolve();
  }
  
  // Expose fullscreen function globally
  window.attemptFullscreen = attemptFullscreen;
</script>
</body>
</html>
